steps:
  - label: ":docker: Build"
    plugins:
      - docker-compose#v3.1.0:
          build: app
          config: docker-compose.buildkite.yml
          image-repository: index.docker.io/bsteffaniak/nova
    env:
      BUILDKITE_DOCKER_COMPOSE_CONTAINER: "app"
      BUILDKITE_DOCKER_COMPOSE_FILE: "docker-compose.buildkite.yml"
      COMPOSE_HTTP_TIMEOUT: 600
    timeout_in_minutes: 10

  - wait

  - label: "Test"
    command: test.sh
    plugins:
      - docker-compose#v3.1.0:
          run: app